import 'package:flutter/material.dart';
import 'package:flutter_application_1/store/favorite_bloc.dart/favorite_event.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:flutter_svg/flutter_svg.dart';

import '../shared/api.dart';
import '../store/favorite_bloc.dart/favorite_bloc.dart';
import '../store/favorite_bloc.dart/favorite_state.dart';

class MaterialInfo extends StatefulWidget {
  final objMaterial;

  const MaterialInfo({
    super.key, 
    required this.objMaterial
  });
  
  @override
  State<MaterialInfo> createState() => _MaterialInfoState();
}

class _MaterialInfoState extends State<MaterialInfo> {
  var _like;
  var _read;

  @override
  void initState() {
    _like = false;
    _read = false;

    super.initState();
  }

  void handlerFavorite() {
    setState(() {
      _like = !_like;
    });
  }

  void handlerRead(link) async {
    var arr = link.split('/');
    await changeCompleteMaterial(arr[2]);
  }

  @override
  Widget build(BuildContext context) {
    
    final favorite = FavoriteBloc();
    favorite.add(FavoriteInitEvent());
    return Row(
      mainAxisAlignment: MainAxisAlignment.spaceBetween,
      children: [
        Row(
          children: [
            Container(
              margin: const EdgeInsets.only(right: 8.0),
              width: 40.0,
              height: 40.0,
              decoration: BoxDecoration(
                shape: BoxShape.circle,
                image: DecorationImage(
                  image: NetworkImage(widget.objMaterial['author']['img']),
                  fit: BoxFit.cover,
                ),
              ),
            ),
            Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Text(widget.objMaterial['date'], style: TextStyle(color: Colors.white),),
                Row(
                  children: [
                    if(widget.objMaterial['type']['name'] == 'Видео')
                      SvgPicture.string('<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.9999 4.66666C11.9999 3.93133 11.4019 2.99995 10.6666 2.99995H2.66659C1.93125 2.99995 1 3.93133 1 4.66666V11.3333C1 12.0687 1.93125 13 2.66659 13H10.6666C11.4019 13 11.9999 12.0687 11.9999 11.3333V8.99995L15 11.3333V4.66666L11.9999 6.99995V4.66666Z" fill="white"></path></svg>'),
                    
                    if(widget.objMaterial['type']['name'] == 'Текст')
                      SvgPicture.string('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.6667 11.2556C2.50101 11.2556 2.3667 11.3899 2.3667 11.5556V12.5333C2.3667 12.699 2.50101 12.8333 2.6667 12.8333H9.00003C9.20926 12.8333 9.40992 12.7502 9.55786 12.6023C9.70581 12.4543 9.78892 12.2537 9.78892 12.0444C9.78892 11.8352 9.70581 11.6346 9.55786 11.4866C9.40992 11.3387 9.20926 11.2556 9.00003 11.2556H2.6667Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M2.6667 8.58887C2.50101 8.58887 2.3667 8.72318 2.3667 8.88887V9.86665C2.3667 10.0323 2.50101 10.1666 2.6667 10.1666H12.4445C12.6537 10.1666 12.8544 10.0835 13.0023 9.93558C13.1503 9.78764 13.2334 9.58698 13.2334 9.37776C13.2334 9.16853 13.1503 8.96787 13.0023 8.81993C12.8544 8.67198 12.6537 8.58887 12.4445 8.58887H2.6667Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M2.6667 5.92224C2.50101 5.92224 2.3667 6.05656 2.3667 6.22224V7.20002C2.3667 7.3657 2.50101 7.50002 2.6667 7.50002H9.55559C9.65919 7.50002 9.76177 7.47961 9.85748 7.43997C9.9532 7.40032 10.0402 7.34221 10.1134 7.26896C10.1867 7.1957 10.2448 7.10874 10.2844 7.01303C10.3241 6.91731 10.3445 6.81473 10.3445 6.71113C10.3445 6.60753 10.3241 6.50495 10.2844 6.40924C10.2448 6.31352 10.1867 6.22656 10.1134 6.1533C10.0402 6.08005 9.9532 6.02194 9.85748 5.98229C9.76177 5.94265 9.65919 5.92224 9.55559 5.92224H2.6667Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M2.6667 3.25555C2.50101 3.25555 2.3667 3.38987 2.3667 3.55555V4.53333C2.3667 4.69902 2.50101 4.83333 2.6667 4.83333H13C13.2093 4.83333 13.4099 4.75022 13.5579 4.60227C13.7058 4.45433 13.7889 4.25367 13.7889 4.04444C13.7889 3.83522 13.7058 3.63456 13.5579 3.48661C13.4099 3.33867 13.2093 3.25555 13 3.25555H2.6667Z" fill="white"></path></svg>'),
                    
                    if(widget.objMaterial['type']['name'] == 'Эфир')
                      SvgPicture.string('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="12" viewBox="0 0 16 12" fill="none"><path d="M3.05005 1.05002C2.39996 1.70004 1.88428 2.47175 1.53245 3.32108C1.18063 4.1704 0.999542 5.08071 0.999542 6.00002C0.999542 6.91934 1.18063 7.82965 1.53245 8.67897C1.88428 9.5283 2.39996 10.3 3.05005 10.95C3.14113 11.0443 3.19152 11.1706 3.19038 11.3017C3.18925 11.4328 3.13666 11.5582 3.04396 11.6509C2.95125 11.7436 2.82585 11.7962 2.69475 11.7974C2.56365 11.7985 2.43735 11.7481 2.34305 11.657C1.60014 10.9142 1.01082 10.0322 0.608759 9.06159C0.206696 8.09096 -0.000244141 7.05063 -0.000244141 6.00002C-0.000244141 4.94942 0.206696 3.90909 0.608759 2.93846C1.01082 1.96783 1.60014 1.0859 2.34305 0.343025C2.43735 0.251946 2.56365 0.201549 2.69475 0.202688C2.82585 0.203827 2.95125 0.256412 3.04396 0.349116C3.13666 0.44182 3.18925 0.567226 3.19038 0.698324C3.19152 0.829423 3.14113 0.955724 3.05005 1.05002ZM5.17205 3.17202C4.42216 3.92214 4.0009 4.93937 4.0009 6.00002C4.0009 7.06068 4.42216 8.07791 5.17205 8.82802C5.21853 8.87451 5.25541 8.9297 5.28057 8.99044C5.30573 9.05118 5.31868 9.11628 5.31868 9.18202C5.31868 9.24777 5.30573 9.31287 5.28057 9.37361C5.25541 9.43435 5.21853 9.48954 5.17205 9.53603C5.12556 9.58251 5.07037 9.61939 5.00963 9.64455C4.94889 9.66971 4.88379 9.68266 4.81805 9.68266C4.7523 9.68266 4.6872 9.66971 4.62646 9.64455C4.56572 9.61939 4.51054 9.58251 4.46405 9.53603C3.99961 9.07172 3.6312 8.52046 3.37984 7.91375C3.12849 7.30703 2.99912 6.65674 2.99912 6.00002C2.99912 5.3433 3.12849 4.69302 3.37984 4.0863C3.6312 3.47959 3.99961 2.92834 4.46405 2.46403C4.55793 2.37014 4.68527 2.31739 4.81805 2.31739C4.95082 2.31739 5.07816 2.37014 5.17205 2.46403C5.26593 2.55791 5.31868 2.68525 5.31868 2.81802C5.31868 2.9508 5.26593 3.07814 5.17205 3.17202ZM10.828 2.46403C10.8745 2.41746 10.9297 2.38052 10.9904 2.35531C11.0512 2.33011 11.1163 2.31713 11.182 2.31713C11.2478 2.31713 11.3129 2.33011 11.3737 2.35531C11.4344 2.38052 11.4896 2.41746 11.536 2.46403C12.0005 2.92834 12.3689 3.47959 12.6203 4.0863C12.8716 4.69302 13.001 5.3433 13.001 6.00002C13.001 6.65674 12.8716 7.30703 12.6203 7.91375C12.3689 8.52046 12.0005 9.07172 11.536 9.53603C11.4896 9.58251 11.4344 9.61939 11.3736 9.64455C11.3129 9.66971 11.2478 9.68266 11.182 9.68266C11.1163 9.68266 11.0512 9.66971 10.9905 9.64455C10.9297 9.61939 10.8745 9.58251 10.828 9.53603C10.7816 9.48954 10.7447 9.43435 10.7195 9.37361C10.6944 9.31287 10.6814 9.24777 10.6814 9.18202C10.6814 9.11628 10.6944 9.05118 10.7195 8.99044C10.7447 8.9297 10.7816 8.87451 10.828 8.82802C11.5779 8.07791 11.9992 7.06068 11.9992 6.00002C11.9992 4.93937 11.5779 3.92214 10.828 3.17202C10.7815 3.12558 10.7445 3.0704 10.7193 3.00966C10.6941 2.94891 10.6812 2.88379 10.6812 2.81802C10.6812 2.75226 10.6941 2.68714 10.7193 2.62639C10.7445 2.56565 10.7815 2.51047 10.828 2.46403ZM12.95 0.344025C13.0438 0.25029 13.171 0.197632 13.3035 0.197632C13.4361 0.197632 13.5633 0.25029 13.657 0.344025C15.1571 1.84429 15.9998 3.87897 15.9998 6.00052C15.9998 8.12208 15.1571 10.1568 13.657 11.657C13.5627 11.7481 13.4364 11.7985 13.3053 11.7974C13.1742 11.7962 13.0488 11.7436 12.9561 11.6509C12.8634 11.5582 12.8109 11.4328 12.8097 11.3017C12.8086 11.1706 12.859 11.0443 12.95 10.95C13.6001 10.3 14.1158 9.5283 14.4676 8.67897C14.8195 7.82965 15.0006 6.91934 15.0006 6.00002C15.0006 5.08071 14.8195 4.1704 14.4676 3.32108C14.1158 2.47175 13.6001 1.70004 12.95 1.05002C12.8563 0.956261 12.8037 0.829107 12.8037 0.696525C12.8037 0.563943 12.8563 0.436789 12.95 0.343025V0.344025ZM10 6.00002C10 6.53046 9.78933 7.03917 9.41426 7.41424C9.03919 7.78931 8.53048 8.00002 8.00005 8.00002C7.46961 8.00002 6.96091 7.78931 6.58583 7.41424C6.21076 7.03917 6.00005 6.53046 6.00005 6.00002C6.00005 5.46959 6.21076 4.96088 6.58583 4.58581C6.96091 4.21074 7.46961 4.00003 8.00005 4.00003C8.53048 4.00003 9.03919 4.21074 9.41426 4.58581C9.78933 4.96088 10 5.46959 10 6.00002Z" fill="white"></path></svg>'),
                    
                    Container(
                      margin: const EdgeInsets.only(left: 8.0),
                      child: Text('${widget.objMaterial['time']} минут', style: TextStyle(color: Colors.white), )
                    )
                  ],
                )
              ],
            ),
          ],
        ),
        BlocBuilder<FavoriteBloc, FavoriteState>(
          bloc: favorite,
          builder: (context, state) {
            return  Row(
              children: [
                InkWell(                        
                  child: Container(
                    margin: const EdgeInsets.only(right: 4),
                    child: SvgPicture.string(
                      !_like ? '''<svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="20" cy="20" r="20" fill="white"></circle><path d="M15.2694 19.889C14.0795 18.2593 14.4761 15.8148 16.4592 15C18.4423 14.1852 19.6321 15.8148 20.0287 16.6297C20.4253 15.8148 22.0118 14.1852 23.9948 15C25.9779 15.8148 25.9779 18.2593 24.7881 19.889C23.5982 21.5186 20.0287 24.7779 20.0287 24.7779C20.0287 24.7779 16.4592 21.5186 15.2694 19.889Z" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>''' :  
                        '''<svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="20" cy="20" r="20" fill="black"></circle><path d="M15.2694 19.889C14.0795 18.2593 14.4761 15.8148 16.4592 15C18.4423 14.1852 19.6321 15.8148 20.0287 16.6297C20.4253 15.8148 22.0118 14.1852 23.9948 15C25.9779 15.8148 25.9779 18.2593 24.7881 19.889C23.5982 21.5186 20.0287 24.7779 20.0287 24.7779C20.0287 24.7779 16.4592 21.5186 15.2694 19.889Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>'''
                      ),
                  ),                        
                  onTap: () {handlerFavorite();},                      
                ),
                if(state is FavoriteLoadedState)
                  InkWell(                        
                    child: Container(
                      margin: const EdgeInsets.only(right: 4),
                      child: SvgPicture.string('''<svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="20" cy="20" r="20" fill="${state.favorite.contains(widget.objMaterial['id']) ? 'black' : 'white'}"></circle><path d="M21.0448 16.0216C21.2299 15.8455 21.4762 15.7481 21.7317 15.75C21.9872 15.7519 22.232 15.853 22.4144 16.032C22.5967 16.211 22.7025 16.4538 22.7092 16.7092C22.716 16.9647 22.6232 17.2127 22.4506 17.4011L17.2087 23.9567C17.1185 24.0538 17.0097 24.1317 16.8888 24.1858C16.7679 24.2399 16.6373 24.269 16.5048 24.2715C16.3724 24.2739 16.2408 24.2497 16.1179 24.2001C15.9951 24.1505 15.8835 24.0767 15.7898 23.983L12.3136 20.5068C12.2168 20.4166 12.1392 20.3078 12.0853 20.187C12.0314 20.0661 12.0025 19.9356 12.0002 19.8033C11.9978 19.671 12.0222 19.5396 12.0717 19.4169C12.1213 19.2942 12.195 19.1828 12.2886 19.0892C12.3822 18.9957 12.4936 18.9219 12.6163 18.8723C12.739 18.8228 12.8704 18.7984 13.0027 18.8008C13.135 18.8031 13.2655 18.8321 13.3863 18.8859C13.5072 18.9398 13.616 19.0174 13.7062 19.1142L16.4572 21.8639L21.0186 16.0505C21.0268 16.0404 21.0355 16.0308 21.0448 16.0216ZM19.8362 22.7744L21.0448 23.983C21.1385 24.0765 21.25 24.1502 21.3727 24.1996C21.4955 24.249 21.6269 24.2733 21.7592 24.2708C21.8915 24.2684 22.0219 24.2393 22.1427 24.1853C22.2636 24.1314 22.3723 24.0536 22.4624 23.9567L27.7069 17.4011C27.8011 17.3081 27.8756 17.197 27.926 17.0746C27.9763 16.9521 28.0015 16.8208 27.9999 16.6884C27.9984 16.5561 27.9702 16.4253 27.917 16.3041C27.8638 16.1829 27.7867 16.0736 27.6904 15.9828C27.594 15.892 27.4804 15.8216 27.3562 15.7757C27.232 15.7298 27.0998 15.7094 26.9676 15.7157C26.8354 15.722 26.7058 15.755 26.5865 15.8125C26.4673 15.87 26.3609 15.951 26.2736 16.0505L21.7109 21.8639L21.0737 21.2254L19.8349 22.7744H19.8362Z" fill="${state.favorite.contains(widget.objMaterial['id']) ? 'white' : 'black'}"></path></svg>''')
                    ),                        
                    onTap: () {handlerRead(widget.objMaterial['link']);}
                  )
              ],
            );
          }
        )
        // Row(
        //   children: [
        //     InkWell(                        
        //       child: Container(
        //         margin: const EdgeInsets.only(right: 4),
        //         child: SvgPicture.string(
        //           !_read ? '''<svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="20" cy="20" r="20" fill="white"></circle><path d="M21.0448 16.0216C21.2299 15.8455 21.4762 15.7481 21.7317 15.75C21.9872 15.7519 22.232 15.853 22.4144 16.032C22.5967 16.211 22.7025 16.4538 22.7092 16.7092C22.716 16.9647 22.6232 17.2127 22.4506 17.4011L17.2087 23.9567C17.1185 24.0538 17.0097 24.1317 16.8888 24.1858C16.7679 24.2399 16.6373 24.269 16.5048 24.2715C16.3724 24.2739 16.2408 24.2497 16.1179 24.2001C15.9951 24.1505 15.8835 24.0767 15.7898 23.983L12.3136 20.5068C12.2168 20.4166 12.1392 20.3078 12.0853 20.187C12.0314 20.0661 12.0025 19.9356 12.0002 19.8033C11.9978 19.671 12.0222 19.5396 12.0717 19.4169C12.1213 19.2942 12.195 19.1828 12.2886 19.0892C12.3822 18.9957 12.4936 18.9219 12.6163 18.8723C12.739 18.8228 12.8704 18.7984 13.0027 18.8008C13.135 18.8031 13.2655 18.8321 13.3863 18.8859C13.5072 18.9398 13.616 19.0174 13.7062 19.1142L16.4572 21.8639L21.0186 16.0505C21.0268 16.0404 21.0355 16.0308 21.0448 16.0216ZM19.8362 22.7744L21.0448 23.983C21.1385 24.0765 21.25 24.1502 21.3727 24.1996C21.4955 24.249 21.6269 24.2733 21.7592 24.2708C21.8915 24.2684 22.0219 24.2393 22.1427 24.1853C22.2636 24.1314 22.3723 24.0536 22.4624 23.9567L27.7069 17.4011C27.8011 17.3081 27.8756 17.197 27.926 17.0746C27.9763 16.9521 28.0015 16.8208 27.9999 16.6884C27.9984 16.5561 27.9702 16.4253 27.917 16.3041C27.8638 16.1829 27.7867 16.0736 27.6904 15.9828C27.594 15.892 27.4804 15.8216 27.3562 15.7757C27.232 15.7298 27.0998 15.7094 26.9676 15.7157C26.8354 15.722 26.7058 15.755 26.5865 15.8125C26.4673 15.87 26.3609 15.951 26.2736 16.0505L21.7109 21.8639L21.0737 21.2254L19.8349 22.7744H19.8362Z" fill="black"></path></svg>''' : 
        //             '''<svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="20" cy="20" r="20" fill="black"></circle><path d="M21.0448 16.0216C21.2299 15.8455 21.4762 15.7481 21.7317 15.75C21.9872 15.7519 22.232 15.853 22.4144 16.032C22.5967 16.211 22.7025 16.4538 22.7092 16.7092C22.716 16.9647 22.6232 17.2127 22.4506 17.4011L17.2087 23.9567C17.1185 24.0538 17.0097 24.1317 16.8888 24.1858C16.7679 24.2399 16.6373 24.269 16.5048 24.2715C16.3724 24.2739 16.2408 24.2497 16.1179 24.2001C15.9951 24.1505 15.8835 24.0767 15.7898 23.983L12.3136 20.5068C12.2168 20.4166 12.1392 20.3078 12.0853 20.187C12.0314 20.0661 12.0025 19.9356 12.0002 19.8033C11.9978 19.671 12.0222 19.5396 12.0717 19.4169C12.1213 19.2942 12.195 19.1828 12.2886 19.0892C12.3822 18.9957 12.4936 18.9219 12.6163 18.8723C12.739 18.8228 12.8704 18.7984 13.0027 18.8008C13.135 18.8031 13.2655 18.8321 13.3863 18.8859C13.5072 18.9398 13.616 19.0174 13.7062 19.1142L16.4572 21.8639L21.0186 16.0505C21.0268 16.0404 21.0355 16.0308 21.0448 16.0216ZM19.8362 22.7744L21.0448 23.983C21.1385 24.0765 21.25 24.1502 21.3727 24.1996C21.4955 24.249 21.6269 24.2733 21.7592 24.2708C21.8915 24.2684 22.0219 24.2393 22.1427 24.1853C22.2636 24.1314 22.3723 24.0536 22.4624 23.9567L27.7069 17.4011C27.8011 17.3081 27.8756 17.197 27.926 17.0746C27.9763 16.9521 28.0015 16.8208 27.9999 16.6884C27.9984 16.5561 27.9702 16.4253 27.917 16.3041C27.8638 16.1829 27.7867 16.0736 27.6904 15.9828C27.594 15.892 27.4804 15.8216 27.3562 15.7757C27.232 15.7298 27.0998 15.7094 26.9676 15.7157C26.8354 15.722 26.7058 15.755 26.5865 15.8125C26.4673 15.87 26.3609 15.951 26.2736 16.0505L21.7109 21.8639L21.0737 21.2254L19.8349 22.7744H19.8362Z" fill="white"></path></svg>'''
        //         )
        //       ),                        
        //       onTap: () {handlerRead();},                      
        //     )
        //   ],
        // ),
      ],
    );
  }
}